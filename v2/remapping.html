<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueZero (BØ): Remapping: dynamically changing names of nodes and sockets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueZero (BØ)
   </div>
   <div id="projectbrief">Middleware for distributed applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Remapping: dynamically changing names of nodes and sockets </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Names for nodes, topics and services, are usually specified statically, i.e. as constant values in the C++ application.</p>
<p>This works fine for most applications. For example the built-in topic <code>log</code> used by BlueZero for implementing remote logging, is an example of that.</p>
<p>There are cases instead where we need multiple instances of the same node. Since BlueZero doesn't allow two nodes in the same network to have the same name, when starting a second instance of the same node, the name will be automatically changed by resolver during the announceNode handshake phase. This is not a big deal, as the node name is not usually needed for addressing other sockets.</p>
<p>However, if the node offers a service, it will not be possible to startup the same node twice, as the second instance of the node will fail to register its own service socket address with the specified name.</p>
<p>Another usecase is with topics: topics create a named network connection between two nodes. If we have a pair of nodes, one with a publisher, and one with a subscriber, those are going to be connected always via the same named channel (i.e. the topic). Starting multiple instances of the publisher and subscriber node will keep using the existing channel, making it impossible to reuse nodes for doing the same task in different contexts (e.g. an image processing node that can re-used multiple times).</p>
<p>The common pattern that is used in the above mentioned scenarios, is to make the node name, topic name, or service name, to be based on a command line argument, or on an environment variable, so that is possible to have a dynamic node name, topic name or service name.</p>
<p>This usage pattern is so common that BlueZero already provides a way to do it via command line options. The command line options (passed when launching a node) used to do this are:</p>
<ul>
<li><code>--remap-node oldName=newName</code> or in short <code>-NoldName=newName</code></li>
<li><code>--remap-topic oldName=newName</code> or in short <code>-ToldName=newName</code></li>
<li><code>--remap-service oldName=newName</code> or in short <code>-SoldName=newName</code></li>
</ul>
<p>There exists also a fourth option, to remap any name:</p>
<ul>
<li><code>--remap oldName=newName</code> or in short <code>-RoldName=newName</code></li>
</ul>
<p>which is a shorthand for using all of the three options with the same remapping.</p>
<h1><a class="anchor" id="remapping_placeholders"></a>
Special placeholders</h1>
<p>Another common pattern used for creating unique node names, topic names, or service names, is to include the hostname in the node name, or to include the node name in the topic or service name.</p>
<p>BlueZero allows to easily perform these substitutions as well:</p><ul>
<li>the placeholder <code>%h</code> will be replaced with the hostname (<code>B0_HOST_ID</code>);</li>
<li>the placeholder <code>%n</code> will be replaced with the final node name (i.e. after any remapping and after being re-assigned by resolver in case of name clash).</li>
</ul>
<p>So, by assigning a node the name <code>thenode@%h</code>, it will finally get assigned the name <code>thenode@thehostname.local</code> (if <code>thehostname.local</code> is the machine's hostname, or has been set in <code>B0_HOST_ID</code>).</p>
<h1><a class="anchor" id="remapping_example"></a>
Example</h1>
<p>Here we consider a simple example with 3 nodes:</p>
<ul>
<li><a class="el" href="remapping_2const_8cpp-example.html">const</a> is a node publishing a constant value, specified via the <code>-v</code> option, on the <code>out</code> topic;</li>
<li><a class="el" href="remapping_2print_8cpp-example.html">print</a> is a node printing what it receives on the <code>in</code> topic;</li>
<li><a class="el" href="remapping_2operation_8cpp-example.html">operation</a> will perform a mathematical operation, specified via the <code>-o</code> option, on the values received on the <code>a</code> and <code>b</code> topics, and will publish the result on the <code>out</code> topic.</li>
</ul>
<p>In order to connect these nodes, we have to use remapping. For example we can connect an instance of <code>const</code> to an instance of <code>print</code>, by remapping <code>in</code> to <code>out</code> in <code>print</code> node (or by remapping <code>out</code> to <code>in</code> in <code>const</code>). Or we can create a more complex scenario, for example for computing the expression <code>(1+2)*3</code>:</p>
<p><div class="dotgraph">
<img src="dot_remapping-example.png" alt="dot_remapping-example.png" border="0" usemap="#dot_remapping-example.map"/>
<map name="dot_remapping-example.map" id="dot_remapping-example.map"></map>
</div>
</p>
<p>The above node graph has been created by starting the nodes:</p>
<ul>
<li><code>./const -v1 -Tout=x -Nconst=const-1</code></li>
<li><code>./const -v2 -Tout=y -Nconst=const-2</code></li>
<li><code>./operation -o+ -Ta=x -Tb=y -Tout=sum -Noperation=op-sum</code></li>
<li><code>./const -v3 -Tout=z -Nconst=const-3</code></li>
<li><code>./operation -o\* -Ta=sum -Tb=z -Tout=result -Noperation=op-mul</code></li>
<li><code>./print -Tin=result</code> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
