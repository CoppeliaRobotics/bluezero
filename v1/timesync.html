<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueZero (BØ): Time Synchronization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueZero (BØ)
   </div>
   <div id="projectbrief">Middleware for distributed applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Time Synchronization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes how time synchronization works.</p>
<p>The objective of time synchronization is to coordinate otherwise independent clocks. Even when initially set accurately, real clocks will differ after some amount of time due to clock drift, caused by clocks counting time at slightly different rates.</p>
<div class="image">
<img src="timesync_plot1.png" alt="timesync_plot1.png" width="500pt"/>
<div class="caption">
Example of two drifting clocks</div></div>
<p>There is one master clock node, which usualy coincides with the resolver node, and every other node instance will try to synchronize its clock to the master clock, while maintaining a guarrantee on some properties:</p>
<ul>
<li>time must not do arbitrarily big jumps</li>
<li>time must always increase monotonically, i.e. if we read time into variable T1, and after some time we read again time into variable T2, it must always be that T2 &gt;= T1</li>
<li>locally, adjusted time must change at a constant speed, that is, the adjustment must happen at a constant rate</li>
<li>the adjustment must be a continuous function of time, such that even if the time is adjusted at a low rate (typically 1Hz) we get a consistent behavior for sub-second reads</li>
</ul>
<p>Time synchronization never changes the computer's hardware clock. It rather computes an offset to add to the hardware clock.</p>
<p>The method Node::timeUSec() returns the value of the hardware clock corrected by the required offset, while the method Node::hardwareTimeUSec() will return the hardware clock actual value.</p>
<p>Each time a new time is received from master clock (tipically in the heartbeat message) the method Node::updateTime() is called, and a new offset is computed.</p>
<div class="image">
<img src="timesync_plot2.png" alt="timesync_plot2.png" width="500pt"/>
<div class="caption">
Example time series of the offset, which is computed as the difference between local time and remote time. Note that is not required that the offset is received at fixed intervals, and in fact in this example it is not the case.</div></div>
<p>If we look at the offset as a function of time we see that is discontinuous. This is bad because just adding the offset to the hardware clock would cause arbitrarily big jumps and even jump backwards in time, thus violating the two properties stated before.</p>
<div class="image">
<img src="timesync_plot3.png" alt="timesync_plot3.png" width="500pt"/>
<div class="caption">
The adjusted time obtained by adding the offset to local time</div></div>
<p>To fix this, the offset function is smoothed so that it is continuous, and limited in its rate of change (max slope). It is important that the max slope is always greater than zero, so as to produce an actual change, and strictly less than 1, so as to not cause time to stop or go backwards.</p>
<div class="image">
<img src="timesync_plot4.png" alt="timesync_plot4.png" width="500pt"/>
<div class="caption">
The smoothed offset. In this example we used a max slope of 0.5, such that the time adjustment is at most half second per second.</div></div>
<div class="image">
<img src="timesync_plot5.png" alt="timesync_plot5.png" width="500pt"/>
<div class="caption">
The resulting adjusted time</div></div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
